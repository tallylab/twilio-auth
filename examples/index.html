<!doctype html>
<html>
  <head>
    <title>Twilio Auth Example</title>

    <style>
      label { display: block; }
      #step2 { display: none; }
    </style>
  </head>
  <body>
    <h1>Twilio Auth Examples</h1>

    <script>
      window.submitVerification = function(form) {
        const telephoneNumber = form.elements[0].value

        fetch("http://127.0.0.1:3000/verify", {
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          method: 'POST',
          body: JSON.stringify({
            phoneNumber: telephoneNumber
          })
        })

        // TODO: Keep phone number in field
        // TODO: Error handling
        document.querySelector('#step1').style.display = 'none';
        document.querySelector('#step2').style.display = 'block';

        return false;
      }

      window.submitCode = function(form) {
        const telephoneNumber = form.elements[0].value
        const verificationCode = form.elements[1].value

        fetch("http://127.0.0.1:3000/login", {
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          method: 'POST',
          body: JSON.stringify({
            phoneNumber: telephoneNumber,
            verificationCode: verificationCode
          })
        })

        return false;
      }
    </script>

    <form id="step1" onsubmit="return submitVerification(this)">
      <label>Input number for verification
        <input type="tel" value="" />
      </label>

      <input type="submit" value="Submit" />
    </form>

    <form id="step2" onsubmit="return submitCode(this)">
      <label>Input number for verification
        <input type="tel" value="" />
      </label>

      <label>Enter code
        <input type="number" value="" />
      </label>

      <input type="submit" value="Submit" />
    </form>
  </body>
</html>
